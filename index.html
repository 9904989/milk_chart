<!doctype html>
<html>

<head>
    <title>Evie's Milk Chart</title>
    <script src="https://s3.amazonaws.com/stitch-sdks/js/bundles/4.6.0/stitch.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
	<style>
	canvas{
		-moz-user-select: none;
		-webkit-user-select: none;
		-ms-user-select: none;
	}
	</style>
</head>

<body onload="get_data();">
	<div style="width:90%;">
		<canvas id="canvas"></canvas>
	</div>
	<script>
        const client = stitch.Stitch.initializeDefaultAppClient('evie_tracker-qprfn');
		const db = client.getServiceClient(stitch.RemoteMongoClient.factory, 'mongodb-atlas').db('log_entries');
		client.auth.loginWithCredential(new stitch.AnonymousCredential()).catch(console.error);

    //Read log entries from Mongo
	function get_data() {
        const x_values = [];
        const y_values = [];

        db.collection('evie_log')
        .find({"icon": "bottle"}, {limit: 100, sort: {"blog_date": -1, "time": -1}})
        .toArray()
        .then(docs => {
        docs.map(doc => {
            //x_values.push([doc.time,doc.blog_date]);
			x_values.push(doc.time);
			y_values.push(doc.volume);
		});
		const ctx = document.getElementById('canvas').getContext('2d');
            const config = {
			type: 'line',
			data: {
				labels: x_values,
				datasets: [{
					label: "Evie's Milk",
					data: y_values,
					fill: false,
				}]
			},
			options: {
				responsive: true,
				title: {
					display: true,
					text: 'Milk Chart'
				},
				tooltips: {
					mode: 'index',
					intersect: false,
				},
				hover: {
					mode: 'nearest',
					intersect: true
				},
				scales: {
					xAxes: [{
						display: true,
						scaleLabel: {
							display: true,
							labelString: 'Time (hh:mm)'
						}
					}],
					yAxes: [{
						display: true,
						scaleLabel: {
							display: true,
							labelString: 'Volume (ml)'
						}
					}]
				}
			}
		};
		var milk_chart = new Chart(ctx, config);
		}).catch(err => {
		});
    }
	</script>
</body>

</html>
